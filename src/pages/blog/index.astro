---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const blogPosts = await getCollection('blog', ({ data }) => {
  return import.meta.env.PROD ? data.draft !== true : true;
});

const sortedPosts = blogPosts.sort((a, b) => 
  new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);
---

<BaseLayout title="Blog - coremanual.link">
  <h1>Blog Posts</h1>
  
  {sortedPosts.length === 0 ? (
    <p>No blog posts yet. Add markdown files to <code>coremanual.link/blog/</code> to get started.</p>
  ) : (
    <ul class="blog-list">
      {sortedPosts.map((post) => (
        <li class="blog-item">
          <h2><a href={`/blog/${post.slug}`}>{post.data.title}</a></h2>
          <div class="blog-meta">
            <time datetime={post.data.date.toISOString()}>
              {post.data.date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
              })}
            </time>
            {post.data.author && <span> â€¢ By {post.data.author}</span>}
          </div>
          {post.data.description && <p>{post.data.description}</p>}
        </li>
      ))}
    </ul>
  )}
</BaseLayout>

